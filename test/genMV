while getopts "LNS:D:A:T" opt; do
  case $opt in

    L)
      echo "Liste des VM enregistrées :"
      vboxmanage list vms
      ;;

    N)
    	echo "Création d'une nouvelle VM..."
      # Exemple minimal, tu peux adapter
		NUM=$(( $(vboxmanage list vms | wc -l) + 1 ))
		VMNAME="VM$NUM"
		RAM="4096"
		DISK="65536"
		ISO_PATH="debian-13.1.0-amd64-netinst.iso"

		# Créer la VM

		echo "$VMNAME Création de la vm"
		vboxmanage createvm --name "$VMNAME" --ostype Debian_64 --register

		echo "$VMNAME Configuration ram, nat et boot "
		vboxmanage modifyvm "$VMNAME" --memory $RAM --nic1 nat --boot1 disk

		echo "$VMNAME Création du disk virtuel"
		vboxmanage createmedium disk --filename "/home/user/VirtualBox VMs/${VMNAME}_disk.vdi" --size $DISK

		echo "$VMNAME Création contrôleur SATA + attachement de disk"
		vboxmanage storagectl "$VMNAME" --name "SATA Controller" --add sata --controller IntelAhci
		vboxmanage storageattach "$VMNAME" --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium "/home/user/VirtualBox VMs/${VMNAME}_disk.vdi"

		echo "$VMNAME Attachement ISO pour installation"
		vboxmanage storageattach "$VMNAME" --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium "$ISO_PATH"

		echo "$VMNAME La VM a été créée avec succès"
    	;;

    S)
      if [ -z "$OPTARG" ]; then
        echo "Erreur : -S attend un nom de VM"
        exit 1
      fi
      VMNAME="$OPTARG"
      echo "Suppression de la VM '$VMNAME'..."
      vboxmanage unregistervm "$VMNAME" --delete
      ;;

    D)
      if [ -z "$OPTARG" ]; then
        echo "Erreur : -D attend un nom de VM"
        exit 1
      fi
      VMNAME="$OPTARG"
      echo "Démarrage de la VM '$VMNAME'..."
      vboxmanage startvm "$VMNAME" --type gui
      ;;

    A)
      if [ -z "$OPTARG" ]; then
        echo "Erreur : -A attend un nom de VM"
        exit 1
      fi
      VMNAME="$OPTARG"
      echo "Arrêt de la VM '$VMNAME'..."
      vboxmanage controlvm "$VMNAME" poweroff
      ;;

	T)
	  echo "Suppression de toutes les VMs..."
	  vboxmanage list vms | while read -r VM; do
		  VMNAME="${VM%% *}"
		  VMNAME="${VMNAME//\"/}"

		  echo "Suppression de $VMNAME ..."
		  vboxmanage unregistervm "$VMNAME" --delete
	  done
	  ;;

    *)
      echo "Option invalide ! Usage: $0 -L|-N|-S <VM>|-D <VM>|-A <VM>|-T"
      exit 1
      ;;

  esac
done
